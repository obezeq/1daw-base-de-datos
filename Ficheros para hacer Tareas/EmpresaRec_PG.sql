-- ************ TABLAS
-- ************ EMPRESAREC.sql
-- HAY QUE ASEGURARSE QUE ESTÁ BIEN EL DATESTYLE (el formato de la fecha)

-- EN ORACLE ERA:
--ALTER SESSION SET NLS_DATE_FORMAT='DD/MM/YYYY';
--SET LINESIZE 150
--SET PAGESIZE 50

DROP TABLE IF EXISTS CENTROS CASCADE;
CREATE TABLE CENTROS(
  COD_CE		NUMERIC(2)		PRIMARY KEY,
  DIRECTOR_CE	NUMERIC(2),
  NOMB_CE		VARCHAR(20)	NOT NULL,
  DIRECC_CE		VARCHAR(20)	NOT NULL,
  POBLAC_CE		VARCHAR(10)	NOT NULL
);


DROP TABLE IF EXISTS DEPARTAMENTOS CASCADE;
CREATE TABLE DEPARTAMENTOS(
  COD_DE		NUMERIC(3)		PRIMARY KEY,
  DIRECTOR_DE	NUMERIC(2),
  DEPTJEFE_DE	NUMERIC(3),
  CENTRO_DE		NUMERIC(2)		NOT NULL,
  NOMB_DE		VARCHAR(25)	NOT NULL,
  PRESUP_DE		NUMERIC(9)		NOT NULL,
  TIPODIR_DE	CHAR(1)			NOT NULL
);


DROP TABLE IF EXISTS EMPLEADOS CASCADE;
CREATE TABLE EMPLEADOS(
  COD_EM		NUMERIC(2)	PRIMARY KEY,
  DEPT_EM		NUMERIC(3),
  EXTTEL_EM		CHAR(9),
  FECINC_EM		DATE,
  FECNAC_EM		DATE,
  DNI_EM		VARCHAR(9)		UNIQUE,
  NOMB_EM		VARCHAR(35) 	NOT NULL,
  NUMHIJ_EM		NUMERIC(2)		NOT NULL,
  SALARIO_EM	NUMERIC(7) 		NOT NULL,
  COMISION_EM	NUMERIC(6)
);


DROP TABLE IF EXISTS HIJOS CASCADE;
CREATE TABLE HIJOS(
  PADRE_HI	NUMERIC(6),
  NUMHIJ_HI	NUMERIC(2),
  FECNAC_HI	DATE,
  NOMB_HI	VARCHAR(25),
  PRIMARY KEY (PADRE_HI, NUMHIJ_HI)
);


--REM *************** INSERCIÓN DE DATOS EN LAS TABLAS*************


--REM ********** TABLA CENTROS: *************

INSERT INTO CENTROS VALUES (10, 1, 'Direccion General', 'Av. Constitucion 88', 'Murcia');
INSERT INTO CENTROS VALUES (20, 6, 'Fabrica Zona Sur' , 'Pol. Ind. Don Manue', 'Sevilla');
INSERT INTO CENTROS VALUES (30, 5, 'Oficinas Zona Sur', 'Jabugo 2'           , 'Sevilla');

COMMIT;

--REM ********** TABLA DEPARTAMENTOS: *************

INSERT INTO DEPARTAMENTOS VALUES (100, 5,   NULL , 30, 'Administracion Zona Sur'  ,  140000, 'P');
INSERT INTO DEPARTAMENTOS VALUES (200, 1,   NULL , 10, 'Direccion General'        ,  260000, 'P');
INSERT INTO DEPARTAMENTOS VALUES (300, 2, 200, 10, 'Investigacion y Diseño'   ,  250000, 'P');
INSERT INTO DEPARTAMENTOS VALUES (400, 6,   NULL , 20, 'Jefatura Fabrica Zona Sur',   62000, 'F');
INSERT INTO DEPARTAMENTOS VALUES (500, 9, 400, 20, 'Produccion Zona Sur'      , 1080000, 'P');
INSERT INTO DEPARTAMENTOS VALUES (600, 3, 100, 30, 'Ventas Zona Sur'          ,  135000, 'F');

COMMIT;

--REM ********** TABLA EMPLEADOS: *************

INSERT INTO EMPLEADOS VALUES ( 5,100,  1239, CURRENT_DATE,'15/11/1986','55645991T','Arias Grillo, Jairo                ', 1, 62000,    0);
INSERT INTO EMPLEADOS VALUES ( 7,500,  NULL, CURRENT_DATE,'05/08/1995','54652636D','Arnaldos Valle, Javier             ', 0, 16000, 6000);
INSERT INTO EMPLEADOS VALUES ( 6,400, 23838, CURRENT_DATE,'12/04/1997','71106202D','Avila Ferrete, Raquel Maria        ', 0, 50000,    0);
INSERT INTO EMPLEADOS VALUES ( 9,500, 12124, CURRENT_DATE,'10/12/1996','56646516D','Cabrera Alava, Kilian              ', 2, 31000,    0);
INSERT INTO EMPLEADOS VALUES ( 2,300,  2233, CURRENT_DATE,'11/01/1996','51506642K','Calderon Diaz, Daniel              ', 0, 45000, 5000);
INSERT INTO EMPLEADOS VALUES ( 8,500,  NULL, CURRENT_DATE,'31/10/1995','55980648H','Calvo Jimenez, Alberto             ', 1, 16000, 6000);
INSERT INTO EMPLEADOS VALUES ( 3,600,  2133, CURRENT_DATE,'06/12/1995','64555339D','Camacho Lindsey, Daniel            ', 1, 52000,    0);
INSERT INTO EMPLEADOS VALUES (10,500,  NULL, CURRENT_DATE,'09/05/1987','37839343D','Conde Alvarez, Jose Antonio        ', 0, 13000, 3000);
INSERT INTO EMPLEADOS VALUES ( 1,200,  1111, CURRENT_DATE,'26/08/1987','76138301V','Del Junco Suarez, Malvina          ', 1, 72000,    0);
INSERT INTO EMPLEADOS VALUES ( 4,600,  3838, CURRENT_DATE,'12/02/1979','67918627L','Fernandez Benito, Javier           ', 0, 32000,    0);
INSERT INTO EMPLEADOS VALUES (15,100,  1239, CURRENT_DATE,'22/04/1993','63453550T','Gallego Carvajal, Juan             ', 0, 62000,    0);
INSERT INTO EMPLEADOS VALUES (17,500,  NULL, CURRENT_DATE,'10/02/1997','90676183D','Garcia Vazquez, Jose Manuel        ', 0, 16000, 6000);
INSERT INTO EMPLEADOS VALUES (16,400, 23838, CURRENT_DATE,'19/05/1997','22563618D','Gata Masero, Carlos                ', 0, 50000,    0);
INSERT INTO EMPLEADOS VALUES (19,500, 12124, CURRENT_DATE,'29/06/1997','48443585D','Gil Campos, David                  ', 0, 31000,    0);
INSERT INTO EMPLEADOS VALUES (12,300,  2233, CURRENT_DATE,'04/11/1997','47141695K','Gomez Alba, Gonzalo                ', 0, 45000, 5000);
INSERT INTO EMPLEADOS VALUES (18,500,  NULL, CURRENT_DATE,'18/01/1988','76723706H','Jimenez Campos, Alejandro          ', 0, 16000, 6000);
INSERT INTO EMPLEADOS VALUES (13,600,  2133, CURRENT_DATE,'01/01/1997','22599031D','Jimenez Garcia, Jose Manuel        ', 0, 52000,    0);
INSERT INTO EMPLEADOS VALUES (20,500,  NULL, CURRENT_DATE,'06/05/1989','76186874D','Leon Vazquez, Rafael               ', 0, 13000, 3000);
INSERT INTO EMPLEADOS VALUES (11,200,  1111, CURRENT_DATE,'27/09/1997','76647678V','Marquez Funes, Marcos              ', 0, 72000,    0);
INSERT INTO EMPLEADOS VALUES (14,600,  3838, CURRENT_DATE,'09/01/1989','92369400L','Matito Lozano, Carmen              ', 0, 32000,    0);
INSERT INTO EMPLEADOS VALUES (25,100,  1239, CURRENT_DATE,'16/12/1992','54523162T','Menacho Cabo, Pedro Jose           ', 0, 62000,    0);
INSERT INTO EMPLEADOS VALUES (27,500,  NULL, CURRENT_DATE,'04/12/1996','34287936D','Mendizabal Romero, Luis            ', 0, 16000, 6000);
INSERT INTO EMPLEADOS VALUES (26,400, 23838, CURRENT_DATE,'24/01/1979','54015399D','Montane Rodriguez, Francisco Javier', 0, 50000,    0);
INSERT INTO EMPLEADOS VALUES (29,500, 12124, CURRENT_DATE,'06/03/1993','85750368D','Montes Rodriguez, Victor           ', 0, 31000,    0);
INSERT INTO EMPLEADOS VALUES (22,300,  2233, CURRENT_DATE,'30/03/1991','46167848K','Perez Alvarez, Javier              ', 0, 45000, 5000);
INSERT INTO EMPLEADOS VALUES (28,500,  NULL, CURRENT_DATE,'24/09/1996','53036510H','Pineda Santos, Jose Manuel         ', 0, 16000, 6000);
INSERT INTO EMPLEADOS VALUES (23,600,  2133, CURRENT_DATE,'07/04/1995','65408034D','Pires Barranco, Amador Claudio     ', 0, 52000,    0);
INSERT INTO EMPLEADOS VALUES (30,500,  NULL, CURRENT_DATE,'06/08/1998','27892539D','Pozo Martin, Ismael                ', 0, 13000, 3000);
INSERT INTO EMPLEADOS VALUES (21,200,  1111, CURRENT_DATE,'25/12/1994','59126147V','Punta Perez, Gonzalo               ', 0, 72000,    0);
INSERT INTO EMPLEADOS VALUES (24,600,  3838, CURRENT_DATE,'30/05/1992','52426286L','Reina Ramirez, Joaquin Javier      ', 0, 32000,    0);
INSERT INTO EMPLEADOS VALUES (35,100,  1239, CURRENT_DATE,'29/03/1994','27962126T','Rivas Barba, Miguel                ', 0, 62000,    0);
INSERT INTO EMPLEADOS VALUES (31,500,  NULL, CURRENT_DATE,'13/09/1993','22481393D','Rolo Vera, Luis Miguel             ', 0, 16000, 6000);
INSERT INTO EMPLEADOS VALUES (32,400, 23838, CURRENT_DATE,'31/03/1995','56373194D','Rufo Rodriguez, Alejandro          ', 0, 50000,    0);
INSERT INTO EMPLEADOS VALUES (33,500, 12124, CURRENT_DATE,'29/12/1997','36090320D','Toscano Fernandez, Juan            ', 0, 31000,    0);
INSERT INTO EMPLEADOS VALUES (34,300,  2233, CURRENT_DATE,'23/07/1997','93739487K','Valverde Gallego, Enrique          ', 0, 45000, 5000);

--TCG: PDTE
--UPDATE EMPLEADOS SET FECINC_EM = ADD_MONTHS(FECINC_EM,-TO_CHAR(FECNAC_EM,'DD'));  --esto era en oracle
UPDATE EMPLEADOS
SET FECINC_EM = FECINC_EM - INTERVAL '187 days' * TO_CHAR(FECNAC_EM, 'DD')::INTEGER;
COMMIT;

--REM ********** TABLA HIJOS: *************

INSERT INTO HIJOS VALUES (8, 1, '14/03/2015','Calvo Rey, Ana');
INSERT INTO HIJOS VALUES (9, 1, '28/07/2016','Cabrera Santos, Elvira');
INSERT INTO HIJOS VALUES (9, 2, '28/07/2016','Cabrera Santos, Kilian');
INSERT INTO HIJOS VALUES (3, 1, '12/09/2015','Camacho Rey, Jesus');
INSERT INTO HIJOS VALUES (5, 1, '06/03/2014','Arias Calvo, Mateo');
INSERT INTO HIJOS VALUES (1, 1, '12/12/2005','Ruiz Del Junco, Juan');

COMMIT;


--REM ********** CLAVES AJENAS *************************


ALTER TABLE EMPLEADOS 		ADD CONSTRAINT FK_DEPART FOREIGN KEY (DEPT_EM ) REFERENCES DEPARTAMENTOS ON DELETE CASCADE;
ALTER TABLE CENTROS 		ADD CONSTRAINT FK_DIR FOREIGN KEY (DIRECTOR_CE) REFERENCES EMPLEADOS ON DELETE CASCADE;
ALTER TABLE DEPARTAMENTOS 	ADD CONSTRAINT FK_DIRER FOREIGN KEY (DIRECTOR_DE) REFERENCES EMPLEADOS ON DELETE CASCADE;
ALTER TABLE DEPARTAMENTOS 	ADD CONSTRAINT FK_DEPT FOREIGN KEY (DEPTJEFE_DE) REFERENCES DEPARTAMENTOS ON DELETE CASCADE;
ALTER TABLE DEPARTAMENTOS 	ADD CONSTRAINT FK_CENTRO FOREIGN KEY (CENTRO_DE) REFERENCES CENTROS ON DELETE CASCADE;
ALTER TABLE HIJOS 			ADD CONSTRAINT FK_PADRE FOREIGN KEY (PADRE_HI) REFERENCES EMPLEADOS ON DELETE CASCADE;

COMMIT;

SELECT * FROM CENTROS;
SELECT * FROM DEPARTAMENTOS;
SELECT * FROM HIJOS;
SELECT * FROM EMPLEADOS;

--REM ********** FIN *************************
